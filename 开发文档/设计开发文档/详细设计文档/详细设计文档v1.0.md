# 软件详细设计文档

[TOC]

## 1. 引言

### 1.1 编制目的
   本报告详细完成对互联网酒店预订系统的详细设计，达到指导后续软件构造的目的，同时实现和测试人员及用户的沟通。
   本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表
|词汇名称|词汇含义|备注|
|:-:|:-:|:-:|
|HRS|互联网酒店预订系统|英文简称|

### 1.3 参考资料
   - IEEE标准
   - 连锁商店管理系统（MSCS）软件详细设计描述文档

## 2. 产品概述
   参考互联网酒店预订系统用例文档和互联网酒店预订系统软件需求规格说明文档中对产品的概括描述

## 3. 体系结构设计概述
   参考互联网酒店预订系统体系结构设计文档中对体系结构设计的描述

## 4. 结构视角

### 4.1 业务逻辑层的分解
   业务逻辑层的开发包图参见软件体系结构文档

#### 4.1.1 admin 模块

   - （1）模块概述
      admin 模块承担的需求参见需求需求规格说明文档文档功能需求及相关非功能需求
      admin 模块的职责及接口参见软件结构描述文档
      
   - （2）整体结构
      根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。admin 模块设计有 AdminController、AdminService、AdminMapper，分别对应展示层与业务逻辑层的接口，业务逻辑层的实现接口，业务逻辑层和数据层的接口。
      admin 模块各个类的职责如表所示

      
      |模块|职责|
      |-|-|
      |AdminController|负责提供展示层网站管理员所需的服务|
      |AdminService|负责提供网站管理员所需的业务逻辑处理接口|
      |AdminServiceImpl|负责提供网站管理员所需的业务逻辑处理实现|
      |AdminMapper|负责向数据层请求网站管理员所需的服务|

      admin模块设计如下图所示
      ![admin模块设计](https://git.nju.edu.cn/Biadlo/image/uploads/980a3a25f95cc17269b3c34da5034483/Admin_module.png)

      
   - （3）模块内部类的接口规范
  
 **AdminController接口规范**
  
|提供的接口(供接口)   |   |    |
|:-------:|:------:|:------|
|     | 语法 | public ResponseVO addStaff(UserForm userForm) |
| AdminContorller.addStaff | 前置条件 | 收到带有 UserFormVO 的 POST 请求 |
|     | 后置条件 | 调用 AdminService 的 addStaff 方法 |
| | - | - |
|     | 语法 | public ResponseVO addStaff(UserForm userForm) |
| AdminController.addBusi | 前置条件 | 收到带有 UserFormVO 的 POST 请求 |
|     | 后置条件 | AdminService 的 addBusi 方法 |
| | - | - |
|     | 语法 | public ResponseVO getAllStaffs() |
| AdminController.getAllStaffs | 前置条件 | 收到 POST 请求 |
|     | 后置条件 | 调用 AdminService 的 getAllStaffs 方法 |
| | - | - |
|     | 语法 |public ResponseVO getAllBusis() |
| AdminController.getAllBusis | 前置条件 | 收到 POST 请求 |
|     | 后置条件 | 调用 AdminService 的 getAllBusis 方法 |
| | - | - |

| 需要的接口(需接口) |    |
|:-------:|:------:|
| **服务名** | **服务** |
|AdminService.addStaff(UserForm userForm)|添加酒店工作人员|
|AdminService.addBusi(UserForm userForm)|添加网站营销人员|
|AdminService.getAllStaffs()|返回所有酒店工作人员|
|AdminService.getAllBusis()|返回所有网站营销人员|


**AdminService接口规范**

|提供的接口(供接口)   |   |    |
|:-------:|:------:|:------|
|     | 语法 | ResponseVO addStaff(UserForm userForm); |
| Admin.addStaff | 前置条件 | 网站管理人员已成功登录 |
|     | 后置条件 | 添加酒店工作人员账号，持久化更新涉及的领域对象的数据 |
| | - | - |
| | 语法 | List<User> getAllStaffs(); |
| Admin.getAllStaffs | 前置条件 | 网站管理人员已成功登录 |
| | 后置条件 | 获得所有酒店工作人员信息 |
| | - | - |
| | 语法 | ResponseVO addBusi(UserForm userForm); |
| Admin.addBusi | 前置条件 | 网站管理人员已成功登录 |
| | 后置条件 | 添加网站营销人员账号，持久化更新涉及的领域对象的数据 |
| | - | - |
| | 语法 | List<User> getAllBusis(); |
| Admin.getAllBusis; | 前置条件 | 网站管理人员已成功登录 |
| | 后置条件 | 获得所有网站营销人员信息 |
| | - | - |
| | 语法 | List<User> getAllClients(); |
| Admin.getAllClients | 前置条件 | 网站管理人员已成功登录 |
| | 后置条件 | 获取所有Client信息 |
| | 语法 | int getHotelIdByStaffId(int staffId); |
| Admin.getHotelIdByStaffId | 前置条件 | 网站管理人员已成功登录 |
| | 后置条件 | 根据StaffId,返回对应hotelId |

| 需要的接口(需接口) |    |
|:-------:|:------:|
| **服务名** | **服务** |
| AdminMapper.addStaff(User user); | 插入一个酒店工作人员的持久化对象 |
| AdminMapper.getAllStaffs(); | 查找所有酒店工作人员的持久化对象 |
| AdminMapper.addBusi(User user); | 插入一个网站营销人员的持久化对象 |
| AdminMapper.getAlBusis(); | 查找所有网站营销人员的持久化对象 |
| AdminMapper.getAllClients(); | 查找所有客户的持久化对象 |
| HotelMapper.selectByStaffId(int staffId); | 根据StaffId查找所属酒店Id |

   - （4）业务逻辑层的动态模型
下图表明了HRS中用户填写添加酒店工作人员信息表单并提交后，用户管理逻辑处理的相关对象之间的协作
![addStaff顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/a88ed19448536ce6b029ac81c34bf5f9/addStaff.png)
下图所示的状态图描述了AdminServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果addStaff方法被UI调用，进入User状态
![addStaff状态图](https://git.nju.edu.cn/Biadlo/image/uploads/d057a73dd0b5f475fd382d2d2e23687c/addStaff2.png)
下图表明了HRS中用户填写添加网站营销人员信息表单并提交后，用户管理逻辑处理的相关对象之间的协作
![addBusi顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/6ab6ee547b8333b24de292d8bec1036c/addBusi.png)
下图所示的状态图描述了AdminServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。addBusi方法被UI调用，进入User状态
![addBusi状态图](https://git.nju.edu.cn/Biadlo/image/uploads/705310d0cc19cd2f82d339cd2a8176ed/addBusi2.png)
下图表明了HRS中用户请求获取所有酒店工作人员列表后，用户管理逻辑处理的相关对象之间的协作
![getAllStaffs顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/633952c2e3ae4a1661b59d2845d03903/getAllStaffs.png)
下图所示的状态图描述了AdminServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。getAllStaffs方法被UI调用，进入List状态
![getAllStaffs状态图](https://git.nju.edu.cn/Biadlo/image/uploads/fc91eef81a76994758e4664c39dea41a/getAllStaffs2.png)
下图表明了HRS中用户请求获取所有客户列表后，用户管理逻辑处理的相关对象之间的协作
![getAllClients顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/488f1e3ea3b6cfb6a3f03470c137f150/getAllClients.png)
下图所示的状态图描述了AdminServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。getAllClients方法被UI调用，进入List状态
![getAllClients状态图](https://git.nju.edu.cn/Biadlo/image/uploads/948edf598adaf63a9d367c26a9a861ea/getAllClients2.png)
下图表明了HRS中用户请求获取所有网站营销人员列表后，用户管理逻辑处理的相关对象之间的协作
![getAllBusis顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/bcbb4f033d40f822e88b79ac305be80e/getAllBusis.png)
下图所示的状态图描述了AdminServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。getAllBusis方法被UI调用，进入List状态
![getAllBusis状态图](https://git.nju.edu.cn/Biadlo/image/uploads/3a96bd4738706cea6216fc3b61ba1b5d/getAllBusis2.png)
下图表明了HRS中酒店工作人员根据id获取所管理的酒店时，用户管理逻辑处理的相关对象之间的协作
![getChargeHotelIdByStaffId顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/a2b46228915be1ba476716f9bcddcfda/getHotelIdByStaffId.png)
下图所示的状态图描述了AdminServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。getHotelIdByStaffId方法被UI调用，进入HotelVO状态
![getChargeHotelIdByStaffId状态图](https://git.nju.edu.cn/Biadlo/image/uploads/f0e3ec521de7bc4db45855ffdd951fac/getHotelIdByStaffId_0.png)


   - （5）业务逻辑层的设计原理
  利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。

#### 4.1.2 user 模块

   - （1）模块概述
      user 模块承担的需求参见需求需求规格说明文档文档功能需求及相关非功能需求
      user 模块的职责及接口参见软件结构描述文档
      
   - （2）整体结构
      根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。user 模块设计有 AccountController、AccountService、AccountMapper，分别对应展示层与业务逻辑层的接口，业务逻辑层的实现接口，业务逻辑层和数据层的接口。
      user 模块各个类的职责如表所示
      
      |模块|职责|
      |-|-|
      |AccountController|负责提供展示层帐户信息所需的服务|
      |AccountService|负责提供网站管理员所需的业务逻辑处理接口|
      |AccountServiceImpl|负责提供帐户信息所需的业务逻辑处理实现|
      |AccountMapper|负责向数据层请求帐户信息所需的服务|

      user模块设计如下图所示
      ![user模块设计](https://git.nju.edu.cn/Biadlo/image/uploads/d788cafaa0ae8fd48314ade28e2707d9/User_module.png)

      
   - （3）模块内部类的接口规范
**AccountController接口规范**
  
|提供的接口(供接口)   |   |    |
|:-------:|:------:|:------|
|     | 语法 | public ResponseVO login(@RequestBody UserForm userForm) |
| AccountController.login | 前置条件 | 收到带有 UserFormVO 的 POST 请求 |
|     | 后置条件 | 调用 AccountService 的 login 方法 |
| | - | - |
|     | 语法 | public ResponseVO registerAccount(@RequestBody UserVO userVO)|
|  AccountController.registerAccount | 前置条件 | 收到带有 UserVO 的 POST 请求 |
|     | 后置条件 | AccountService 的 registerAccount 方法 |
| | - | - |
|     | 语法 |public ResponseVO getUserInfo(@PathVariable int id)  |
| AccountController.getUserInfo | 前置条件 | 收到带有  POST 请求 |
|     | 后置条件 | 调用 AccountService 的 getUserInfo 方法 |
| | - | - |
|     | 语法 |public ResponseVO updateInfo(@RequestBody UserInfoVO userInfoVO, @PathVariable int id) |
| AccountController.updateInfo | 前置条件 | 收到带有 UserInfoVO 的 POST 请求 |
|     | 后置条件 | 调用 AccountService 的 updateUserInfo 方法 |
| | - | - |
|     | 语法 |public ResponseVO getCreditRecord(@PathVariable int id)|
| AccountController.getCreditRecord | 前置条件 | 收到 POST 请求 |
|     | 后置条件 | 调用 AccountService 的 getCreditRecord 方法 |
| | - | - |
|     | 语法 |public ResponseVO rechargeCredit(@RequestBody RechargeCreditVO rechargeCreditVO)|
| AccountController.rechargeCredit | 前置条件 | 收到带有 RechargeCreditVO 的 POST 请求 |
|     | 后置条件 | 调用 AccountService 的 rechargeCredit 方法 |

| 需要的接口(需接口) |    |
|:-------:|:------:|
| **服务名** | **服务** |
|AccountService.login(UserForm userForm)|登陆|
|AccountService.registerAccount(UserVO userVO)|注册|
|AccountService.getUserInfo(int id)|获取指定用户信息|
|AccountService.updateUserInfo(int id, String password, String username, String phonenumber)|更新指定用户信息|
|AccountService.getCreditRecord(Integer userId)|获取指定用户信用记录|
|AccountService.rechargeUserCredit(double changeCredit, int userId)|获取指定用户信用记录|

**AccountService接口规范**


|   提供的接口(供接口)                   |  |                                                       |
| :------------------: | :------: | :---------------------------------------------------- |
|                      |   语法   | ResponseVO registerAccount(UserVO userVO);            |
| AccountService.registerAccount | 前置条件 | email,password,userName,phoneNumber符合输入规则       |
|                      | 后置条件 | 根据输入信息，返回注册的结果                          |
|                      |   语法   | User login(UserForm userForm);                        |
|      AccountService.login      | 前置条件 | email,password符合输入规范                            |
|                      | 后置条件 | 查找是否存在相应的User,根据输入的password返回用户对象 |
|             -              |    -     | -                                                            |
|                            |   语法   | User getUserInfo(int id); |
| AccountService.getUserInfo | 前置条件 | 无 |
|                            | 后置条件 | 返回用户个人信息 |
|             -              |    -     | -                                                            |
|                            |   语法   | ResponseVO updateUserInfo(int id, String password,String username,String phonenumber); |
| AccountService.updateUserInfo | 前置条件 | 无 |
|                            | 后置条件 | 更新用户个人信息，返回更新的结果 |
|-|-|-|
| | 语法 | List<CreditRecord> getCreditRecord(Integer userId); |
| | 前置条件 | 无 |
| AccountService.getCreditRecord | 后置条件 | 获取信用记录 |
|-|-|-|
| | 语法 | ResponseVO rechargeUserCredit(double changeCredit,int userId); |
| AccountService.rechargeUserCredit | 前置条件 | 无 |
| | 后置条件 | 为用户进行信用充值 |

|                            需要的接口(需接口)                            |                                   |
| :----------------------------------------------------------: | :-------------------------------: |
|                          **服务名**                          |             **服务**              |
|          AccountMapper.createNewAccount(User user);          |     插入用户的单一持久化对象      |
| AccountMapper.getAccountByName(@Param("email") String email); | 根据email查找用户的单一持久化对象 |
|      AccountMapper.getAccountById(@Param("id") int id);      |  根据ID查找用户的单一持久化对象   |
| AccountMapper.updateAccount(@Param("id") int id, @Param("password") String password,@Param("userName") String username, @Param("phoneNumber") String phonenumber); |           更新用户信息            |
| CreditMapper.selectCreditRecordById(@Param("userid") int userid); |    根据userid返回信用记录列表     |
| CreditMapper.insertCreditRecord(CreditRecord creditRecord);  |           插入信用记录            |
| CreditMapper.updateUserCredit(@Param("changeCredit") double changeCredit,@Param("userid") int userid); |         改变user的信用值          |
   - （4）业务逻辑层的动态模型
下图表明了HRS中用户填写注册表单并提交后，账户管理逻辑处理的相关对象之间的协作
![registerAccount顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/6b612117f13064591865bbd9328e5179/registerAccount.png)
下图所示的状态图描述了AccountServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果registerAccount方法被UI调用，进入User状态
![registerAccount状态图](https://git.nju.edu.cn/Biadlo/image/uploads/204dad1e38306e54de2f9eacc3d75eb8/registerAccount_0.png)
下图表明了HRS中用户填写登陆表单并提交后，账户管理逻辑处理的相关对象之间的协作
![login顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/0ccd73603bb2a535d191e9fd4479a4ae/login.png)
下图所示的状态图描述了AccountServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果login方法被UI调用，进入User状态
![login状态图](https://git.nju.edu.cn/Biadlo/image/uploads/81ec60447d7b090d32dd36a8eb768d5a/login2.png)
下图表明了HRS中用户填写登陆表单并提交后，账户管理逻辑处理的相关对象之间的协作
![getUserInfo顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/18277a656dfa8efaae386fc5c260208c/getUserInfo.png)
下图所示的状态图描述了AccountServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果getUserInfo方法被UI调用，进入User状态
![getUserInfo状态图](https://git.nju.edu.cn/Biadlo/image/uploads/7d437623649022a51a3e8def130ff49a/getUserInfo2.png)
下图表明了HRS中用户填写修改信息表单并提交后，账户管理逻辑处理的相关对象之间的协作
![updateUserInfo顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/f3d65285afff1171e333e5e75dddd471/updateInfo.png)
下图所示的状态图描述了AccountServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果getUserInfo方法被UI调用，进入User状态
![updateUserInfo状态图](https://git.nju.edu.cn/Biadlo/image/uploads/90a2064292ca6337d518631eb770892a/updateUserInfo.png)
下图表明了HRS中用户根据id获取信用记录时，账户管理逻辑处理的相关对象之间的协作
![getCreditRecord顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/ee7812a765d95b781013b4b5e5fa07b5/getCreditRecord.png)
下图所示的状态图描述了AccountServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果getCreditRecord方法被UI调用，进入List状态
![getCreditRecord状态图](https://git.nju.edu.cn/Biadlo/image/uploads/b129ae4c09acc3b59dd6c305d223516f/getCreditRecord_0.png)
下图表明了HRS中用户提交充值信用账户表单时，账户管理逻辑处理的相关对象之间的协作
![rechargeCredit顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/1060637ccf60119bd1e923b8c69f7f7b/rechargeCredit.png)
下图所示的状态图描述了AccountServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果rechargeCredit方法被UI调用，进入List状态
![rechargeCredit状态图](https://git.nju.edu.cn/Biadlo/image/uploads/3e73ccf7969e492ad715f939714926d8/rechargeUserCredit.png)

   - （5）业务逻辑层的设计原理

  利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。

#### 4.1.3 order 模块

- （1）模块概述

  order 模块承担的需求参见需求需求规格说明文档文档功能需求及相关非功能需求
  order 模块的职责及接口参见软件体系结构描述文档

- （2）整体结构

  根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。order 模块设计有 OrderController、OrderService、OrderMapper，分别对应展示层与业务逻辑层的接口，业务逻辑层的实现接口，业务逻辑层和数据层的接口。

  order 模块的设计如下图所示

![order模块设计](https://user-images.githubusercontent.com/48647774/85720591-28889700-b723-11ea-8b5f-a1c4bb55674d.png)

- （3）模块内部类的接口规范

**OrderController的接口规范**

|           提供的服务(供接口)            |          |                                                              |
| :-------------------------------------: | :------: | :----------------------------------------------------------- |
|                                         |   语法   | public ResponseVO reserveHotel(@RequestBody OrderVO orderVO) |
|      OrderController.reserveHotel       | 前置条件 | 收到Post请求                                                 |
|                                         | 后置条件 | 调用OrderService的addOrder方法                               |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO retrieveAllOrders()                        |
|    OrderController.retrieveAllOrders    | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的getAllOrders的方法                         |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO retrieveUserOrders(@PathVariable int userId) |
|   OrderController.retrieveUserOrders    | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的getUserOrders方法                          |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO annulOrder(@PathVariable int orderId)      |
|       OrderController.annulOrder        | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的annulOrder方法                             |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO restoreOrder(@PathVariable int orderId)    |
|      OrderController.restoreOrder       | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的restoreOrder方法                           |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO execOrder(@PathVariable int orderId)       |
|        OrderController.execOrder        | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的execOrder方法                              |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO overdue(@PathVariable int orderId)         |
|         OrderController.overdue         | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的overdue方法                                |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO recheck(@PathVariable int orderId)         |
|         OrderController.recheck         | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的recheck方法                                |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO checkout(@PathVariable int orderId)        |
|        OrderController.checkout         | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的checkout方法                               |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO getHotelOrdersByStaffId(@PathVariable int userId) |
| OrderController.getHotelOrdersByStaffId | 前置条件 | 收到Get请求                                                  |
|                                         | 后置条件 | 调用OrderService的getHotelOrdersByStaffId方法                |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | public ResponseVO cancelAbnormalOrder(@RequestBody CancelAbnormalOrderVO cancelAbnormalOrderVO) |
|   OrderController.cancelAbnormalOrder   | 前置条件 | 收到Post请求                                                 |
|                                         | 后置条件 | 调用OrderService的cancelAbnormalOrder方法                    |

**OrderService的接口规范**

|          提供的服务(供接口)          |          |                                                              |
| :----------------------------------: | :------: | :----------------------------------------------------------- |
|                                      |   语法   | ResponseVO addOrder(OrderVO orderVO);                        |
|        OrderService.addOrder         | 前置条件 | 已创建订单并填写完毕                                         |
|                                      | 后置条件 | 完成酒店预订，生成订单，并持久化更新涉及的领域对象的数据     |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | List<Order> getAllOrders();                                  |
|      OrderService.getAllOrders       | 前置条件 | 无                                                           |
|                                      | 后置条件 | 获得所有订单信息                                             |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | List<Order> getUserOrders(int userId);                       |
|      OrderService.getUserOrders      | 前置条件 | 无                                                           |
|                                      | 后置条件 | 获得指定用户的所有订单信息                                   |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO annulOrder(int ordeId);                           |
|       OrderService.annulOrder        | 前置条件 | 无                                                           |
|                                      | 后置条件 | 撤销订单，持久化更新涉及的领域对象的数据                     |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | List<Order> getHotelOrdersByStaffId(int userId);             |
| OrderService.getHotelOrdersByStaffId | 前置条件 | 无                                                           |
|                                      | 后置条件 | 返回某个酒店工作人员所属酒店的所有订单                       |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO execOrder(int orderid);                           |
|        OrderService.execOrder        | 前置条件 | 无                                                           |
|                                      | 后置条件 | 订单被执行，持久化更新涉及的领域对象的数据                   |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO restoreOrder(int orderId);                        |
|      OrderService.restoreOrder       | 前置条件 | 无                                                           |
|                                      | 后置条件 | 恢复订单，持久化更新涉及的领域对象的数据                     |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO recheck(int orderId);                             |
|         OrderService.recheck         | 前置条件 | 无                                                           |
|                                      | 后置条件 | 延迟入住，更新订单状态，恢复信用值,持久化更新涉及的领域对象的数据 |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO overdue(int orderId);                             |
|         OrderService.overdue         | 前置条件 | 无                                                           |
|                                      | 后置条件 | 逾期，更新订单状态。扣除信用值,持久化更新涉及的领域对象的数据 |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO checkout(int orderId);                            |
|        OrderService.checkout         | 前置条件 | 无                                                           |
|                                      | 后置条件 | 退房的订单状态更新, 持久化更新涉及的领域对象的数据           |
|                  -                   |    -     | -                                                            |
|                                      |   语法   | ResponseVO cancelAbnormalOrder(int orderId,double ratio);    |
|   OrderService.cancelAbnormalOrder   | 前置条件 | 无                                                           |
|                                      | 后置条件 | 撤销异常订单, 持久化更新涉及的领域对象的数据                 |

|                      需要的服务(需接口)                      |                                     |
| :----------------------------------------------------------: | :---------------------------------: |
|                          **服务名**                          |              **服务**               |
| HotelService.getRoomCurNum(Integer hotelId,String roomType); |      返回酒店剩余某种房间数量       |
| HotelService.updateRoomInfo(Integer hotelId, String roomType,Integer rooms); |      更新客房的单一持久化对象       |
|             AccountService.getUserInfo(int id);              |   根据ID查找用户的单一持久化对象    |
|      RoomService.restoreRoom(hotelId,roomType,roomNum);      |      更新客房的单一持久化对象       |
|   RoomService.updateRoomInfo(hotelId, roomType, roomNum);    |      更新客房的单一持久化对象       |
|              OrderMapper.addOrder(Order order);              |      插入订单的单一持久化对象       |
|                 OrderMapper.getAllOrders();                  |      查找所有订单的持久化对象       |
|   OrderMapper.getUserOrders(@Param("userid") int userid);    | 根据userid查找订单的多个持久化对象  |
|    OrderMapper.annulOrder(@Param("orderid") int orderid);    | 根据订单ID删除订单的单一持久化对象  |
|   OrderMapper.getOrderById(@Param("orderid") int orderid);   | 根据订单ID返回订单的单一持久化对象  |
|   OrderMapper.restoreOrder(@Param("orderid") int orderid);   | 根据订单ID更新订单的单一持久化对象  |
|     OrderMapper.recheck(@Param("orderid") int orderid);      | 根据订单ID更新订单的单一持久化对象  |
|     OrderMapper.overdue(@Param("orderid") int orderid);      | 根据订单ID更新订单的单一持久化对象  |
|  OrderMapper.checkoutOrder(@Param("orderid") int orderid);   | 根据订单ID更新订单的单一持久化对象  |
| OrderMapper.cancelAbnormalOrder(@Param("orderid") int orderid); | 根据订单ID更新订单的单一持久化对象  |
|         OrderMapper.getHotelOrders(Integer hotelId);         | 根据hotelId查找订单的多个持久化对象 |
|             OrderMapper.execOrder(int orderid);              | 根据orderid更新订单的单一持久化对象 |
| CreditMapper.insertCreditRecord(CreditRecord creditRecord);  |            插入信用记录             |
| CreditMapper.updateUserCredit(@Param("changeCredit") double changeCredit,@Param("userid") int userid); |          改变user的信用值           |
|      AccountMapper.getAccountById(@Param("id") int id);      |          根据用ID查找账号           |
| HotelMapper.selectByStaffId(@Param("staffId") int staffId);  |      按照工作人员ID获取酒店ID       |

- （4）业务逻辑层的动态模型

下图表明了HRS中，当客户输入订单信息并提交订单后，订单业务逻辑处理的相关对象之间的协作。

![addOrder顺序图](https://user-images.githubusercontent.com/48647774/85723283-aa79bf80-b725-11ea-9fd3-7937875a05b9.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着reserveHotel方法被UI调用，进入hotelRoom状态，之后通过updateRoomInfo方法进入hotelRoom状态，然后通过addOrder方法进入Order状态

![addOrder状态图](https://user-images.githubusercontent.com/48647774/85724798-23c5e200-b727-11ea-9519-2ecd3d797ff9.png)

下图表明了HRS中，当用户请求获取所有订单，订单业务逻辑处理的相关对象之间的协作。

![getAllOrders顺序图1](https://user-images.githubusercontent.com/48647774/85753621-fd13a580-b73e-11ea-9dc9-4a5a28400b53.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着retrieveAllOrders方法被UI调用，进入OrderList状态

![getAllOrders状态图](https://user-images.githubusercontent.com/48647774/85753846-2fbd9e00-b73f-11ea-8ad6-5922c1dae8cc.png)

下图表明了HRS中，当客户请求查看已有订单时，订单业务逻辑处理的相关对象之间的协作。

![getUserOrders顺序图](https://user-images.githubusercontent.com/48647774/85755070-326cc300-b740-11ea-981d-5f300d429867.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着retrieveUserOrders方法被UI调用，进入OrderList状态

![getUserOrders状态图](https://user-images.githubusercontent.com/48647774/85755075-339df000-b740-11ea-8252-f140fd849391.png)

下图表明了HRS中，当客户请求撤销订单时，订单业务逻辑处理的相关对象之间的协作。

![annulOrder顺序图](https://user-images.githubusercontent.com/48647774/85763756-8d55e880-b747-11ea-8a9a-bc056d2aedba.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着annulOrder方法被UI调用，进入Order状态，之后调用restoreRoom方法，进入HotelRoom状态，之后若当前时间比最晚执行时间晚，则调用updateUserCredit方法，进入Credit状态，之后调用insertCreditRecord方法，进入CreditRecord状态，否则结束

![annualOrder状态图](https://user-images.githubusercontent.com/48647774/85763759-8dee7f00-b747-11ea-9cbc-5f77f8202487.png)

下图表明了HRS中，当客户入住，酒店工作人员执行该订单时，订单业务逻辑处理的相关对象之间的协作。

![execOrder顺序图1](https://user-images.githubusercontent.com/48647774/85818369-15b5a700-b7a3-11ea-8f02-21fdada0a5d8.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着execOrder方法被UI调用，进入Order状态，之后调用updateUserCredit方法，进入Credit状态，之后调用insertCreditRecord方法，进入CreditRecord状态

![execOrder状态图](https://user-images.githubusercontent.com/48647774/85818371-16e6d400-b7a3-11ea-87b7-ae0cd328ee82.png)

下图表明了HRS中，当客户逾期后延迟入住，酒店工作人员办理延迟入住手续时，订单业务逻辑处理的相关对象之间的协作。

![recheck顺序图1](https://user-images.githubusercontent.com/48647774/85818375-19e1c480-b7a3-11ea-8718-d7fe5ce90ff3.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着recheck方法被UI调用，进入Order状态，之后调用updateRoomInfo方法，进入HotelRoom状态，之后调用updateUserCredit方法，进入Credit状态，之后调用insertCreditRecord方法，进入CreditRecord状态

![recheck状态图](https://user-images.githubusercontent.com/48647774/85818381-1c441e80-b7a3-11ea-9ee9-ff3817e31ef7.png)

下图表明了HRS中，当客户逾期，酒店工作人员办理逾期手续时，订单业务逻辑处理的相关对象之间的协作。

![overdue顺序图](https://user-images.githubusercontent.com/48647774/85818391-1ea67880-b7a3-11ea-9c16-275816fb7e81.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着overdue方法被UI调用，进入Order状态，之后调用updateRoomInfo方法，进入HotelRoom状态，之后调用updateUserCredit方法，进入Credit状态，之后调用insertCreditRecord方法，进入CreditRecord状态

![overdue状态图](https://user-images.githubusercontent.com/48647774/85818399-20703c00-b7a3-11ea-8e53-3c766a357ba0.png)

下图表明了HRS中，当客户退房，酒店工作人员办理退房手续时，订单业务逻辑处理的相关对象之间的协作。

![checkout顺序图](https://user-images.githubusercontent.com/48647774/85818987-bf496800-b7a4-11ea-8fd6-3cdf93db3b34.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkout方法被UI调用，进入Order状态，之后调用updateRoomInfo方法，进入HotelRoom状态

![checkout状态图](https://user-images.githubusercontent.com/48647774/85818988-bf496800-b7a4-11ea-80ba-e0921f6eec41.png)

下图表明了HRS中，当酒店工作人员请求查看所属酒店所有订单时，订单业务逻辑处理的相关对象之间的协作。

![getHotelOrdersByStaffId顺序图](https://user-images.githubusercontent.com/48647774/85818990-bfe1fe80-b7a4-11ea-918f-f4cae7bf82a2.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着getHotelOrdersByStaffId方法被UI调用，进入OrderList状态

![getHotelOrdersByStaffId状态图](https://user-images.githubusercontent.com/48647774/85818993-c1132b80-b7a4-11ea-8970-dea788294b2d.png)

下图表明了HRS中，当网站营销人员撤销某个用户的某个异常订单时，订单业务逻辑处理的相关对象之间的协作。

![cancelAbnormal顺序图](https://user-images.githubusercontent.com/48647774/85818405-2239ff80-b7a3-11ea-8a6c-f99e67d42f86.png)

下图所示的状态图描述了OrderServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着cancelAbnormal方法被UI调用，进入Order状态，之后调用updateUserCredit方法，进入Credit状态，之后调用insertCreditRecord方法，进入CreditRecord状态

![cancel](https://user-images.githubusercontent.com/48647774/85818419-26661d00-b7a3-11ea-8cb0-b77fce8b22a8.png)

- （5）业务逻辑层的设计原理

  利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。

#### 4.1.4 hotel 模块

- （1）模块概述
  hotel 模块承担的需求参见需求需求规格说明文档文档功能需求及相关非功能需求
  hotel 模块的职责及接口参见软件体系结构描述文档
- （2）整体结构
  根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。hotel 模块设计有 HotelController,展示层与业务逻辑层的接口；HotelService、RoomServiced对应业务逻辑层的实现接口；HotelMapper、RoomMapper对应业务逻辑层和数据层的接口。

  hotel模块设计如下图所示
  ![hotel模块设计](https://git.nju.edu.cn/Biadlo/image/uploads/f735c8ebfa455a94ab215dcb997eb25e/hotel_module.png)
- （3）模块内部类的接口规范
 
 **HotelController接口规范**
  
|提供的接口(供接口)   |   |    |
|:-------:|:------:|:------|
|     | 语法 | public ResponseVO createHotel(@RequestBody HotelVO hotelVO) |
| HotelController.createHotel | 前置条件 | 收到带有 HotelVO 的 POST 请求 |
|     | 后置条件 | 调用 HotelService 的 addHotel 方法 |
| | - | - |
|     | 语法 | public ResponseVO retrieveAllHotels() |
| HotelController.retrieveAllHotels | 前置条件 | 收到 GET 请求 |
|     | 后置条件 | 调用 HotelService 的 retrieveHotels 方法 |
| | - | - |
|     | 语法 | public ResponseVO addRoomInfo(@RequestBody HotelRoom hotelRoom) |
| HotelController.addRoomInfo | 前置条件 | 收到带有 HotelRoom 的 POST 请求 |
|     | 后置条件 | 调用 RoomService 的 insertRoomInfo 方法 |
| | - | - |
|     | 语法 | public ResponseVO retrieveHotelDetail(@PathVariable Integer hotelId) |
| HotelController.retrieveHotelDetail | 前置条件 | 收到 GET 请求 |
|     | 后置条件 | 调用 HotelService 的 retrieveHotelDetails 方法 |
| | - | - |
|     | 语法 |public ResponseVO updateInfo(@RequestBody HotelInfoVO hotelInfoVO, @PathVariable int id) |
| HotelController.updateInfo | 前置条件 | 收到带有 HotelInfoVO 的 POST 请求 |
|     | 后置条件 | 调用 HotelService 的 updateHotelInfo 方法 |
| | - | - |


| 需要的接口(需接口) |    |
|:-------:|:------:|
| **服务名** | **服务** |
|HotelService.addHotel(HotelVO hotelVO)|添加酒店|
|HotelService.updateRoomInfo(Integer hotelId, String roomType, Integer rooms)|更新房间信息|
|HotelService.getRoomCurNum(Integer hotelId, String roomType)|以获取现有房间数量|
|HotelService.retrieveHotels()|返回所有酒店列表|
|HotelService.retrieveHotelDetails(Integer hotelId)|返回指定酒店信息|
|HotelService.changeHotelRate(Integer orderId, Integer hotelId, Double rate)|改变酒店评分|
|HotelService.updateHotelInfo(int hotelId, String hotelAddress, String bizRegion, String hotelStar, String hotelDescription)|更新酒店信息|
|RoomService.retrieveHotelRoomInfo(Integer hotelId)|返回酒店房间信息|
|RoomService.insertRoomInfo(HotelRoom hotelRoom)|插入房间|
|RoomService.updateRoomInfo(Integer hotelId, String roomType, Integer rooms)|返回酒店房间信息|
|RoomService.getRoomCurNum(Integer hotelId, String roomType)|返回现有指定房间数量|
|RoomService.restoreRoom(Integer hotelId, String roomType, Integer rooms)|恢复房间|





**HotelService,RoomService接口规范**
|          需要的接口(供接口)                  |  |                                                              |
| :------------------------: | :------: | :----------------------------------------------------------- |
|                            |   语法   | void addHotel(HotelVO hotelVO);                              |
|       Hotel.addHotel       | 前置条件 | 无                                                           |
|                            | 后置条件 | 添加酒店，持久化更新涉及的领域对象的数据                     |
|             -              |    -     | -                                                            |
|                            |   语法   | void updateRoomInfo(Integer hotelId, String roomType,Integer rooms); |
|    Hotel.updateRoomInfo    | 前置条件 | 无                                                           |
|                            | 后置条件 | 酒店修改剩余客房信息，持久化更新涉及的领域对象的数据         |
|             -              |    -     | -                                                            |
|                            |   语法   | List<HotelVO> retrieveHotels();                              |
|    Hotel.retrieveHotels    | 前置条件 | 无                                                           |
|                            | 后置条件 | 返回所有酒店信息                                             |
|             -              |    -     | -                                                            |
|                            |   语法   | HotelVO retrieveHotelDetails(Integer hotelId);               |
| Hotel.retrieveHotelDetails | 前置条件 | 无                                                           |
|                            | 后置条件 | 返回某家酒店详细信息                                         |
|             -              |    -     | -                                                            |
|                            |   语法   | int getRoomCurNum(Integer hotelId,String roomType);          |
|    Hotel.getRoomCurNum     | 前置条件 | 无                                                           |
|                            | 后置条件 | 返回酒店剩余某种房间数量                                     |
|             -              |    -     | -                                                            |
| | 语法 | ResponseVO changeHotelRate(Integer orderId, Integer hotelId, Double rate); |
| Hotel.changeHotelRate | 前置条件 | 无 |
| | 后置条件 | 改变酒店评分,修改订单状态为已完成 |
|             -              |    -     | -                                                            |
| | 语法 | ResponseVO updateHotelInfo(int hotelId, String hotelAddress, String bizRegion, String hotelStar, String hotelDescription); |
| Hotel.updateHotelInfo | 前置条件 | 无 |
| | 后置条件 | 修改酒店基本信息 |
|             -              |    -     | -                                                            |
|                            |   语法   | List<HotelRoom> retrieveHotelRoomInfo(Integer hotelId);      |
| Room.retrieveHotelRoomInfo | 前置条件 | 无                                                           |
|                            | 后置条件 | 返回某个酒店的全部房间信息                                   |
|             -              |    -     | -                                                            |
|                            |   语法   | void insertRoomInfo(HotelRoom hotelRoom);                    |
|    Room.insertRoomInfo     | 前置条件 | 无                                                           |
|                            | 后置条件 | 添加酒店客房信息，持久化更新涉及的领域对象的数据             |
|             -              |    -     | -                                                            |
|                            |   语法   | void updateRoomInfo(Integer hotelId, String roomType, Integer rooms); |
|    Room.updateRoomInfo     | 前置条件 | 无                                                           |
|                            | 后置条件 | 更新客房房间数量，持久化更新涉及的领域对象的数据             |
|             -              |    -     | -                                                            |
|                            |   语法   | int getRoomCurNum(Integer hotelId, String roomType);         |
|     Room.getRoomCurNum     | 前置条件 | 无                                                           |
|                            | 后置条件 | 返回酒店指定房间剩余数量                                     |
|             -              |    -     | -                                                            |
|                            |   语法   | ResponseVO restoreRoom(Integer hotelId, String roomType, Integer rooms); |
|      Room.restoreRoom      | 前置条件 | 无                                                           |
|                            | 后置条件 | 恢复客房房间数量，持久化更新涉及的领域对象的数据             |

|                            需接口                            |                                    |
| :----------------------------------------------------------: | :--------------------------------: |
|                          **服务名**                          |              **服务**              |
|             AccountService.getUserInfo(int id);              | 根据id进行查找用户的单一持久化对象 |
|            HotelMapper.insertHotel(Hotel hotel);             |      插入酒店的单一持久化对象      |
|                HotelMapper.selectAllHotel();                 |        返回所有酒店的值对象        |
|       HotelMapper.selectById(@Param("id") Integer id);       |     根据酒店id返回酒店的值对象     |
| HotelMapper.getStaffHotelNum(@Param("staffId") int staffId); |   根据工作人员id返回所属酒店数量   |
|  HotelMapper.changeHotelRate(Integer hotelId, Double rate);  |           更新酒店的评分           |
| HotelMapper.updateHotelInfo(@Param("hotelid") Integer hotelid,@Param("hotelAddress") String hotelAddress,@Param("bizRegion") String bizRegion,@Param("hotelStar") String hotelStar,@Param("hotelDescription") String hotelDescription); |           更新酒店的信息           |
| RoomMapper.updateRoomInfo(Integer hotelId,String roomType,Integer curNum); |      更新房间的单一持久化对象      |
|  RoomMapper.getRoomCurNum(Integer hotelId,String roomType);  | 根据酒店ID和房间类型返回房间的数量 |
|         RoomMapper.insertRoom(HotelRoom hotelRoom);          |      插入房间的单一持久化对象      |
| RoomMapper.selectRoomsByHotelId(@Param("hotelId") Integer hotelId); | 根据酒店ID查找所有房间的持久化对象 |
| RoomMapper.restoreRoom(@Param("hotelId") Integer hotelId,@Param("roomType") String roomType,@Param("curNum") Integer curNum); |      更新房间的单一持久化对象      |
|   OrderMapper.finishOrder(@Param("orderid") int orderid);    |     根据订单id更新状态为已完成     |
| OrderMapper.getHotelFinishOrderNum(@Param("hotelid") int hotelid); |      获取酒店的已完成订单数量      |
- （4）业务逻辑层的动态模型
下图表明了HRS中用户提交创建酒店表单时，账户管理逻辑处理的相关对象之间的协作
![createHotel顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/457f44708b056bb81938baf7f76d0a7b/createHotel.png)
下图所示的状态图描述了HotelServiceImpl与RoomServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果createHotel方法被UI调用，首先调用accountService.getUserInfo进入User状态,然后如果调用hotelMapper.getStaffHotelNum进入staffNum状态，然后如果调用hotelMapper.insertHotel方法进入hotel状态
![createHotel状态图](https://git.nju.edu.cn/Biadlo/image/uploads/7dc2266ac3ab66169262b4dd41efba8a/createHotel2.png)
下图表明了HRS中用户请求返回所有酒店时，账户管理逻辑处理的相关对象之间的协作
![retrieveAllHotels顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/308c40b1b1b9836773b67e40a31914c7/retrieveAllHotels.png)
下图所示的状态图描述了HotelServiceImpl与RoomServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果retrieveAllHotels方法被UI调用，进入List状态
![retrieveAllHotels状态图](https://git.nju.edu.cn/Biadlo/image/uploads/da4bc3ec1357c8d26ea3dd2546926ce1/retrieveAllHotels2.png)
下图表明了HRS中用户填写房间表单并提交时，账户管理逻辑处理的相关对象之间的协作
![addRoomInfo顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/ad3c51627e37af571004e19c8be6d728/addRoomInfo.png)
下图所示的状态图描述了HotelServiceImpl与RoomServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果addRoomInfo方法被UI调用，进入HotelRoom状态
![addRoomInfo状态图](https://git.nju.edu.cn/Biadlo/image/uploads/7ba6e99d0f78f4ab571016114e97e743/addRoomInfo_0.png)
下图表明了HRS中用户选择查看某酒店详细信息时，账户管理逻辑处理的相关对象之间的协作
![retrieveHotelDetail顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/bf72557930934bb56f66bb3776877909/retrieveHotelDetail.png)
下图所示的状态图描述了HotelServiceImpl与RoomServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果addRoomInfo方法被UI调用，首先调用hotelMapper.selectById进入HotelVO状态，然后调用roomService.retrieveHotelRoomInfo方法进入List状态，然后
![retrieveHotelDetail状态图](https://git.nju.edu.cn/Biadlo/image/uploads/2a5c3386ea04342f41ba28c367bc0ac6/retrieveHotelDetail_0.png)
下图表明了HRS中用户填写改变酒店评分表单并提交时，账户管理逻辑处理的相关对象之间的协作
![changeHotelRate顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/594a7d44191d4209a4f374e1971b2386/changeHotelRate.png)
下图所示的状态图描述了HotelServiceImpl与RoomServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果changeHotelRate方法被UI调用，首先调用hotelMapper.selectById方法进入HotelVO状态，然后调用orderMapper.getHotelFinishOrderNum方法,进入FinishOrderNum状态，然后调用hotelMapper.changeHotelRate方法,进入Rate状态，然后调用orderMapper.finishOrder方法，进入FinishOrder状态
![changeHotelRate状态图](https://git.nju.edu.cn/Biadlo/image/uploads/e14703ad7290cb43b12c5c7a298b84a5/changeHotelRate_0.png)
下图表明了HRS中用户填写更新酒店信息表单并提交时，账户管理逻辑处理的相关对象之间的协作
![updateInfo顺序图](https://git.nju.edu.cn/Biadlo/image/uploads/75455398d48fda0de007657dffbbe058/updateHotelInfo.png)
下图所示的状态图描述了HotelServiceImpl与RoomServiceImpl对象的生存期间的状态序列，引起转移的时间，以及因状态转移而伴随的动作。如果updateInfo方法被UI调用，进入Update状态
![updateInfo状态图](https://git.nju.edu.cn/Biadlo/image/uploads/19f54705db966a8bc0e54fafdea36ffc/updateHotelInfo2.png)



- （5）业务逻辑层的设计原理

  利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。

#### 4.1.5 coupon 模块

- （1）模块概述

  coupon 模块承担的需求参见需求需求规格说明文档文档功能需求及相关非功能需求
  coupon 模块的职责及接口参见软件体系结构描述文档

- （2）整体结构

  根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。coupon 模块设计有 CouponController、CouponService、CouponMapper，分别对应展示层与业务逻辑层的接口，业务逻辑层的实现接口，业务逻辑层和数据层的接口。

  coupon模块的设计如下图所示

![coupo模块设计](https://user-images.githubusercontent.com/48647774/85519762-8e4a2580-b634-11ea-90b9-47736e1d1fd0.png)

- （3）模块内部类的接口规范

**CouponController的接口规范**

|             提供的服务(供接口)             |          |                                                              |
| :----------------------------------------: | :------: | :----------------------------------------------------------- |
|                                            |   语法   | public ResponseVO getOrderMatchCoupons(Integer userId,                                        Integer hotelId,Double orderPrice, Integer roomNum,String checkIn, String checkOut) |
|   CouponController.getOrderMatchCoupons    | 前置条件 | 收到Get请求                                                  |
|                                            | 后置条件 | 调用CouponService的getMatchOrderCoupon方法                   |
|                     -                      |    -     | -                                                            |
|                                            |   语法   | public ResponseVO getHotelAllCoupons(@RequestParam Integer hotelId) |
|    CouponController.getHotelAllCoupons     | 前置条件 | 收到Get请求                                                  |
|                                            | 后置条件 | 调用CouponService的getHotelAllCoupon方法                     |
|                     -                      |    -     | -                                                            |
|                                            |   语法   | public ResponseVO addHotelTargetMoneyCoupon(@RequestBody HotelTargetMoneyCouponVO hotelTargetMoneyCouponVO) |
| CouponController.addHotelTargetMoneyCoupon | 前置条件 | 收到Post请求                                                 |
|                                            | 后置条件 | 调用CouponService的addHotelTargetMoneyCoupon方法             |
|                     -                      |    -     | -                                                            |
|                                            |   语法   | public ResponseVO addHotelTimeCoupon(@RequestBody TimeCouponVO timeCouponVO) |
|    CouponController.addHotelTimeCoupon     | 前置条件 | 收到Post请求                                                 |
|                                            | 后置条件 | 调用CouponService的addHotelTimeCoupon方法                    |

**CouponService的接口规范**

|           提供的服务(供接口)            |          |                                                              |
| :-------------------------------------: | :------: | :----------------------------------------------------------- |
|                                         |   语法   | List<Coupon> getMatchOrderCoupon(OrderVO orderVO);           |
|    CouponService.getMatchOrderCoupon    | 前置条件 | 已填写订单的所有信息                                         |
|                                         | 后置条件 | 返回某一订单可用的优惠策略列表                               |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | List<Coupon> getHotelAllCoupon(Integer hotelId);             |
|     CouponService.getHotelAllCoupon     | 前置条件 | 已填写酒店id                                                 |
|                                         | 后置条件 | 返回某个酒店提供的所有优惠策略（包括失效的）                 |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | CouponVO addHotelTargetMoneyCoupon(HotelTargetMoneyCouponVO couponVO); |
| CouponService.addHotelTargetMoneyCoupon | 前置条件 | 无                                                           |
|                                         | 后置条件 | 添加酒店满减优惠策略，持久化更新涉及的领域对象的数据         |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | CouponVO addHotelTimeCoupon(TimeCouponVO couponVO);          |
|    CouponService.addHotelTimeCoupon     | 前置条件 | 无                                                           |
|                                         | 后置条件 | 添加酒店限时优惠策略，持久化更新涉及的领域对象的数据         |
|                    -                    |    -     | -                                                            |
|                                         |   语法   | boolean isMatch(OrderVO orderVO, Coupon coupon);             |
|       CouponMatchStrategy.isMatch       | 前置条件 | 无                                                           |
|                                         | 后置条件 | 返回订单与优惠卷的匹配结果                                   |



|              需要的服务(需接口)               |                                                |
| :-------------------------------------------: | :--------------------------------------------: |
|                  **服务名**                   |                    **服务**                    |
| couponMapper.selectByHotelId(Integer hotelId) | 根据酒店ID进行查找多个酒店优惠策略的持久化对象 |
|   couponMapper.insertCoupon(Coupon coupon)    |        插入单一酒店优惠策略的持久化对象        |

- （4）业务逻辑层的动态模型

下图表明了HRS中，当用户输入订单信息后，优惠卷业务逻辑处理的相关对象之间的协作。

![getMatchOrderCoupon顺序图1](https://user-images.githubusercontent.com/48647774/85672079-18f25980-b6f5-11ea-846e-d9f51aa2bb9b.png)

下图所示的状态图描述了CouponServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着getMatchOrderCoupon方法被UI调用，进入CouponList状态，之后通过isMatch进入Coupon状态，match为真，则回到CouponList状态

![getMatchOrderCoupon状态图](https://user-images.githubusercontent.com/48647774/85672084-1b54b380-b6f5-11ea-8002-77dee46fe9a8.png)

下图表明了HRS中，当酒店工作人员查看该酒店优惠策略时，优惠卷业务逻辑处理的相关对象之间的协作。

![getHotelAllCoupons顺序图](https://user-images.githubusercontent.com/48647774/85672092-1d1e7700-b6f5-11ea-8622-05abb761342b.png)

下图所示的状态图描述了CouponServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着getHotelAllCoupon方法被UI调用，进入CouponList状态

![getHotelAllCoupons状态图](https://user-images.githubusercontent.com/48647774/85672101-1f80d100-b6f5-11ea-8368-2cdc6773c45a.png)

下图表明了HRS中，当酒店工作人员输入添加满减优惠信息后，优惠卷业务逻辑处理的相关对象之间的协作。

![2 addTargetMoneyCoupon顺序图](https://user-images.githubusercontent.com/48647774/85663866-2b1bca00-b6ec-11ea-9ae1-67686eab466a.png)

下图所示的状态图描述了CouponServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着addHotelTargetMoneyCoupon方法被UI调用，进入Coupon状态

![addTargetMoneyCoupon状态图](https://user-images.githubusercontent.com/48647774/85663878-2f47e780-b6ec-11ea-9baa-177d6092dfe1.png)

下图表明了HRS中，当酒店工作人员输入添加限时优惠信息后，优惠卷业务逻辑处理的相关对象之间的协作。

![addTimeCoupon顺序图](https://user-images.githubusercontent.com/48647774/85669145-1e01d980-b6f2-11ea-840d-d1283693c579.png)

下图所示的状态图描述了CouponServiceImpl对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着addHotelTimeCoupon方法被UI调用，进入Coupon状态

![addTimeCoupon状态图](https://user-images.githubusercontent.com/48647774/85669164-22c68d80-b6f2-11ea-961b-a439b11e51e9.png)

- （5）业务逻辑层的设计原理

  利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。



## 5. 依赖视角

![依赖视角](https://git.nju.edu.cn/Biadlo/image/uploads/0f79bcc2abdb2e496791b31499f87913/%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.png)

## 6. 变更记录

| 时间 | 编辑人 | 编辑内容及备注 |
| :--: | :----: | :------------: |
| 5/23 | 戴祺佳 |   初始化文档   |
| 5/25 | 曹邵恒 | 完成admin模块  |
| 5/28 | 曹邵恒 |  完成user模块  |
| 6/5  | 梁鋆亮 | 完成coupon模块 |
| 6/12 | 曹邵恒 | 完成hotel模块  |
| 6/16 | 梁鋆亮 | 完成order模块  |
| 6/18 | 徐宇轩 |  完成依赖视角  |